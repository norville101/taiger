const assert = require('assert')
const { MDParams } = require('../mdparams')

describe('MDParams', function () {
  describe('#parse()', function () {
    it('should parse test case 1', function () {
      this.timeout(0)
      const paramStr = 'Steps: 25, Sampler: dpmpp_2m_sde_gpu_karras, CFG Scale: 5.0, Seed: 1091632168063068, Size: 512x512, Model hash: 94f45bf623, Model: realcartoonRealistic_v8, Version: ComfyUI'
      const x = MDParams.parse(paramStr)
      assert.equal(x.params[0].name, 'Steps')
      assert.equal(x.params[0].value, '25')
      assert.equal(x.params[7].value, 'ComfyUI')
    })
  })

  describe("#parse() AND #toString()", function () {
    const tests = [
      'Steps: 25, Sampler: dpmpp_2m_sde_gpu_karras, CFG Scale: 5.0, Seed: 1091632168063068, Size: 512x512, Model hash: 94f45bf623, Model: realcartoonRealistic_v8, Version: ComfyUI',
      'Steps: 35, Sampler: DPM++ 2M Karras, CFG scale: 8, Seed: 1948521713, Size: 1024x1568, Model hash: da13268e85, Model: τ£╝τ¥¢Θ╝╗σ¡ÉΦÇ│µ£╡σïòµ╝½epic25D_v10, Denoising strength: 0.1, Mask blur: 4, Lora hashes: \"σú½ΘâÄΘüô∩╖┐Φíôσ«╢masamune_shirow_v0.5_065_v0.3_035: adc5b5514877, ∩╖┐Φíôσ«╢opal_00_58πÇÉeye focusπÇæ: 231aec75c983, Gothpunk_V2: a0e0fcc15ab6, eye_opening_v2.0: c102d004095f, matanozoki: 212139145238\", Version: v1.5.2, Hashes: {\"vae\":\"f921fb3f29\",\"model\":\"da13268e85\"}',
      'Steps: 40, Sampler: DPM++ 2M Karras, CFG scale: 7, Seed: 1317112518, Size: 480x720, Model hash: 8405bde9ac, Model: realcartoonRealistic_v8, Denoising strength: 0.5, ENSD: 31337, Version: v1.2.1, Hires upscale: 2, Hires steps: 15, Hires upscaler: Latent, AddNet Enabled: True, AddNet Module 1: LoRA, AddNet Model 1: see-through leotard-000004(c1bd44511f9b), AddNet Weight A 1: 1, AddNet Weight B 1: 1',
      'Steps: 20, Sampler: DDIM, CFG scale: 5, Seed: 16769626, Size: 576x1024, Model hash: 797dab5e63, Model: epicphotogasm_v4One4All, VAE hash: e9ed949371, VAE: vae-ft-ema-560000-ema-pruned.ckpt, Denoising strength: 0.25, RNG: CPU, Hires upscale: 1.875, Hires upscaler: 4x-UltraMix_Restore, Lora hashes: \"RealDownblouse15_v3.2: f318a1602ae5\", Version: v1.6.0',
      'Steps: 25, Sampler: DPM++ 2M Karras, CFG scale: 6, Seed: 3894338219, Size: 512x752, Model hash: ec41bd2a82, Model: photon_v1, VAE hash: df3c506e51, VAE: vae-ft-mse-840000-ema-pruned.safetensors, Denoising strength: 0.45, Style Selector Enabled: True, Style Selector Randomize: False, Style Selector Style: Manga, Hires upscale: 2, Hires steps: 10, Hires upscaler: R-ESRGAN 4x+, Lora hashes: \"shirtlift-08: 05a5d153d4cd\", Version: v1.6.0',
      'Steps: 40, Sampler: Euler, CFG scale: 6.5, Seed: 3544137991, Size: 512x647, Model hash: 94f45bf623, Model: realcartoonRealistic_v8, VAE hash: 6f0163a2b7, VAE: vae-ft-mse-840000-ema-pruned.ckpt, Denoising strength: 0.4, Clip skip: 2, ADetailer model: face_yolov8s.pt, ADetailer confidence: 0.3, ADetailer dilate/erode: 4, ADetailer mask blur: 5, ADetailer denoising strength: 0.25, ADetailer inpaint only masked: True, ADetailer inpaint padding: 56, ADetailer use separate steps: True, ADetailer steps: 42, ADetailer model 2nd: mediapipe_face_mesh_eyes_only, ADetailer confidence 2nd: 0.3, ADetailer dilate/erode 2nd: 4, ADetailer mask blur 2nd: 4, ADetailer denoising strength 2nd: 0.4, ADetailer inpaint only masked 2nd: True, ADetailer inpaint padding 2nd: 32, ADetailer version: 23.9.3, Hires upscale: 2, Hires steps: 10, Hires upscaler: 4x-UltraSharp, Lora hashes: \"rebecca_v1: 9d01ea784692, MS_Real_POV_Blowjob: 53d01822561b, epi_noiseoffset2: d1131f7207d6, more_details: 3b8aa1d351ef, cumshot_49: db16eabc9f3a\", TI hashes: \"bad-hands-5: aa7651be154c, BadDream: 758aac443515, By bad artist -neg: 2d356134903e, FastNegativeV2: a7465e7cc2a2, UnrealisticDream: a77451e7ea07, JuggernautNegative-neg: 979ea73200c7\", Noise multiplier: 1.05, Version: v1.6.0\nTemplate: <lora:rebecca_v1:1.05> 1girl,  rebecca \\(cyberpunk\\) white hair, tattoo, looking at viewer, artificial eye, mechanical eye, ()perfect eyes) (perfect face) long hair, (colored sclera:1.1) <lora:MS_Real_POV_Blowjob:1> deep throat shallow penetration BREAK circumcised deep throat blowjob nsfw  gorgeous oil painting, beautiful composition, woman is deep throat a huge veiny cock, BREAK\n\n close up, emotional, tears, happiness, kind, gentle, soft glow, rays of light, colorful, detailed, stunning, dlsr, high quality, high res, ultra detailed, intimate lighting, cinematic, Rembrandt <lora:epi_noiseoffset2:1>  <lora:more_details:0.2>  <lora:cumshot_49:0.24> cumshot\nNegative Template:  bad-hands-5 BadDream By bad artist -neg FastNegativeV2 UnrealisticDream (watermark) (logo) (signature) (text) (label)  JuggernautNegative-neg (child) (infant) (loli) uncircumcised',
      'Steps: 20, Sampler: DPM++ 2M Karras, CFG scale: 7, Seed: 3887398609, Size: 512x768, Model hash: 240a6e795f, Model: aniverse_thxEd14, VAE hash: c6a580b13a, VAE: vae-ft-mse-840000-ema-pruned.ckpt, Denoising strength: 0.4, Clip skip: 2, ADetailer model: face_yolov8n.pt, ADetailer confidence: 0.3, ADetailer dilate/erode: 4, ADetailer mask blur: 4, ADetailer denoising strength: 0.4, ADetailer inpaint only masked: True, ADetailer inpaint padding: 32, ADetailer version: 23.9.2, Hires upscale: 1.5, Hires steps: 5, Hires upscaler: R-ESRGAN 4x+ Anime6B, Version: v1.6.0',
      'Steps: 20, Sampler: DPM++ 2M Karras, CFG scale: 5, Seed: 651612447, Size: 512x768, Model hash: 797dab5e63, Model: epicPhotoGasmV4, VAE hash: 1006afe4e2, VAE: vae-ft-mse-840000-ema-pruned.safetensors, Denoising strength: 0.35, Hires upscale: 2, Hires steps: 11, Hires upscaler: 4x_NMKD-Superscale-SP_178000_G, Lora hashes: \"pantylines: 41373d1260b5\", Version: v1.6.0',
      'Steps: 20, Sampler: DPM++ 2M Karras, CFG scale: 7, Seed: 2459623705, Face restoration: CodeFormer, Size: 768x960, Model hash: 8405bde9ac, Model: realcartoonRealistic_v8, Denoising strength: 0.75, Clip skip: 2, ADetailer model: mediapipe_face_full, ADetailer confidence: 0.3, ADetailer dilate/erode: 4, ADetailer mask blur: 4, ADetailer denoising strength: 0.4, ADetailer inpaint only masked: True, ADetailer inpaint padding: 32, ADetailer version: 23.9.2, TI hashes: \"FastNegativeV2: a7465e7cc2a2, easynegative: c74b4e810b03\", Version: 1.5.1',
      'Steps: 40, Sampler: DPM++ 2M Karras, CFG scale: 6.5, Seed: 2102307780, Size: 448x672, Model hash: 3c8530cb22, Model: cyberrealistic_v33, VAE hash: 735e4c3a44, VAE: vae-ft-mse-840000-ema-pruned.safetensors, Denoising strength: 0.45, ADetailer model: face_yolov8s.pt, ADetailer prompt: \"beautiful woman supermodel ,perfect lighting , <lora:b1mb0_v3:0.17> ,b1mb0, <lora:th3p1t_b:0.17> ,th3p1t,<lora:marge_simpson:1> marge simpson\", ADetailer negative prompt: \"(worst quality, low quality, normal quality:2),cartoon, painting, illustration,3d,cgi,render, vehicles,car,motorcycle, \", ADetailer confidence: 0.3, ADetailer dilate/erode: 4, ADetailer mask blur: 4, ADetailer denoising strength: 0.4, ADetailer inpaint only masked: True, ADetailer inpaint padding: 32, ADetailer version: 23.9.3, Hires upscale: 2, Hires steps: 20, Hires upscaler: R-ESRGAN 4x+, Lora hashes: \"b1mb0_v3: 6936c9034935, th3p1t_b: 159c070c15ee, marge_simpson: d36ef547082e\", Version: v1.6.0, Hashes: {\"vae\":\"735e4c3a44\",\"lora:b1mb0_v3\":\"a9140772b1\",\"lora:ReaLora\":\"b7b419a144\",\"model\":\"3c8530cb22\"}',
      'Steps: 40, Sampler: DPM++ 2M Karras, CFG scale: 7, Seed: 307293590, Size: 512x512, Model hash: 15012c538f, Model: realisticVisionV5, Denoising strength: 0.7, ADetailer model: face_yolov8n.pt, ADetailer prompt: \"nice face, detailed skin, best quality\", ADetailer confidence: 0.3, ADetailer mask min ratio: 0.005, ADetailer dilate/erode: 4, ADetailer mask blur: 4, ADetailer denoising strength: 0.4, ADetailer inpaint only masked: True, ADetailer inpaint padding: 32, ADetailer version: 23.9.3, Hires upscale: 1.5, Hires upscaler: R-ESRGAN 4x+, Lora hashes: \"mooning_sd15: a67b80c8399c\", Version: v1.6.0',
      'Steps: 20, Sampler: DPM++ 2M Karras, CFG scale: 9, Seed: 4197133012, Size: 1024x1536, Model hash: 879db523c3, Model: dreamshaper_8, VAE hash: 735e4c3a44, VAE: vaeFtMse840000Ema_v100.safetensors, Denoising strength: 0.45, Clip skip: 2, Lora hashes: \"th3p1t_v3: 159c070c15ee\", Version: v1.6.0, Hashes: {\"vae\":\"735e4c3a44\",\"lora:th3p1t_v3\":\"57df4334fd\",\"model\":\"879db523c3\"}',
      'Steps: 30, Sampler: Euler a, CFG scale: 9, Seed: 2956760408, Size: 576x720, Model hash: 879db523c3, Model: dreamshaper_8, VAE hash: 735e4c3a44, VAE: vaeFtMse840000Ema_v100.safetensors, Denoising strength: 0.45, Clip skip: 2, Mask blur: 3, Lora hashes: \"th3p1t_v3: 159c070c15ee, slim_thick: 35c157cd4742, bianca_beauchamp: 084733e1c2ec\", Version: v1.6.0, Hashes: {\"vae\":\"735e4c3a44\",\"lora:th3p1t_v3\":\"57df4334fd\",\"lora:slim_thick\":\"c85eead732\",\"lora:bianca_beauchamp\":\"1c5ca2d28a\",\"model\":\"879db523c3\"}',
      'Steps: 36, Sampler: DPM++ 3M SDE Karras, CFG scale: 7, Seed: 2722892450, Size: 512x768, Model hash: 4e089bea6e, Model: realcartoon3d_v8, VAE hash: e852361da7, VAE: vaeFtMse840000.safetensors, Denoising strength: 0.2, Clip skip: 2, ControlNet 0: \"Module: tile_resample, Model: control_v11f1e_sd15_tile [a371b31b], Weight: 1, Resize Mode: Just Resize, Low Vram: False, Threshold A: 1, Guidance Start: 0, Guidance End: 1, Pixel Perfect: False, Control Mode: Balanced\", Hires upscale: 2, Hires upscaler: 4x_foolhardy_Remacri_ExtraSmoother, Lora hashes: \"fishnet_top by goofy ai: 3b4213de0b7b\", TI hashes: \"easynegative: c74b4e810b03, bad-image-v2-39000: 5b9281d7c6ad, easynegative: c74b4e810b03, bad-image-v2-39000: 5b9281d7c6ad, easynegative: c74b4e810b03, bad-image-v2-39000: 5b9281d7c6ad, easynegative: c74b4e810b03, bad-image-v2-39000: 5b9281d7c6ad, easynegative: c74b4e810b03, bad-image-v2-39000: 5b9281d7c6ad, easynegative: c74b4e810b03, bad-image-v2-39000: 5b9281d7c6ad, easynegative: c74b4e810b03, bad-image-v2-39000: 5b9281d7c6ad, easynegative: c74b4e810b03, bad-image-v2-39000: 5b9281d7c6ad, easynegative: c74b4e810b03, bad-image-v2-39000: 5b9281d7c6ad, easynegative: c74b4e810b03, bad-image-v2-39000: 5b9281d7c6ad, easynegative: c74b4e810b03, bad-image-v2-39000: 5b9281d7c6ad, easynegative: c74b4e810b03, bad-image-v2-39000: 5b9281d7c6ad, easynegative: c74b4e810b03, bad-image-v2-39000: 5b9281d7c6ad, easynegative: c74b4e810b03, bad-image-v2-39000: 5b9281d7c6ad, easynegative: c74b4e810b03, bad-image-v2-39000: 5b9281d7c6ad, easynegative: c74b4e810b03, bad-image-v2-39000: 5b9281d7c6ad, easynegative: c74b4e810b03, bad-image-v2-39000: 5b9281d7c6ad, easynegative: c74b4e810b03, bad-image-v2-39000: 5b9281d7c6ad, easynegative: c74b4e810b03, bad-image-v2-39000: 5b9281d7c6ad, easynegative: c74b4e810b03, bad-image-v2-39000: 5b9281d7c6ad, easynegative: c74b4e810b03, bad-image-v2-39000: 5b9281d7c6ad, easynegative: c74b4e810b03, bad-image-v2-39000: 5b9281d7c6ad, easynegative: c74b4e810b03, bad-image-v2-39000: 5b9281d7c6ad, easynegative: c74b4e810b03, bad-image-v2-39000: 5b9281d7c6ad\", Version: v1.6.0, Hashes: {\"vae\":\"e852361da7\",\"embed:bad-image-v2-39000\":\"5b9281d7c6\",\"embed:easynegative\":\"c74b4e810b\",\"model\":\"4e089bea6e\"}',
      'Steps: 30, Sampler: DPM++ 2M Karras, CFG scale: 6, Seed: 747719930, Face restoration: CodeFormer, Size: 512x768, Model hash: bbf26a639f, Model: duchaitenDarkniji_v133, Denoising strength: 0.4, Clip skip: 2, Hires upscale: 2, Hires steps: 15, Hires upscaler: R-ESRGAN 4x+, TI hashes: \"easynegative: c74b4e810b03, ng_deepnegative_v1_75t: 54e7e4826d53\", Version: v1.5.1',
      'Steps: 30, Sampler: DPM++ 2M Karras, CFG scale: 7, Seed: 670740993, Size: 512x768, Clip skip: 2, Civitai resources: [{\"type\":\"checkpoint\",\"modelVersionId\":165237}]',
      'Steps: 25, Sampler: DPM++ 2M Karras, CFG scale: 7, Seed: 2585302060, Size: 512x768, Model hash: 81c8397ae2, Model: Find & Forget you v1.0, VAE hash: 551eac7037, VAE: vae-ft-mse-840000-ema-pruned.safetensors, Denoising strength: 0.35, Clip skip: 2, ADetailer model: face_yolov8n.pt, ADetailer confidence: 0.3, ADetailer dilate/erode: 4, ADetailer mask blur: 4, ADetailer denoising strength: 0.4, ADetailer inpaint only masked: True, ADetailer inpaint padding: 32, ADetailer version: 23.9.2, Hires upscale: 2, Hires steps: 15, Hires upscaler: 4x_NMKD-Superscale, Lora hashes: \"JinxLol: 29d14d65e702, PovWarizaFromAboveV1: 8322f2f46ea0\", TI hashes: \"negative_hand-neg: 73b524a2da12, verybadimagenegative_v1.3: d70463f87042\", Version: v1.6.0, Hashes: {\"vae\":\"735e4c3a44\",\"embed:negative_hand-neg\":\"73b524a2da\",\"embed:verybadimagenegative_v1.3\":\"d70463f870\",\"lora:JinxLol\":\"5d083880ed\",\"lora:PovWarizaFromAboveV1\":\"ed89966fe7\",\"model\":\"81c8397ae2\"}',
      'Steps: 40, Sampler: Euler a, CFG scale: 7, Seed: 3899488371, Face restoration: CodeFormer, Size: 512x600, Model hash: 8405bde9ac, Model: realcartoonRealistic_v8, Denoising strength: 0.75, Clip skip: 2, Lora hashes: \"add_detail: 7c6bad76eb54\", Version: 1.5.1',
      'Steps: 40, Sampler: DPM adaptive, CFG scale: 7, Seed: 3570432641, Size: 512x800, Model hash: 797dab5e63, Model: epicphotogasm_v4One4All, Denoising strength: 0.2, Hires upscale: 1.5, Hires upscaler: 4x_foolhardy_Remacri, Lora hashes: \"RealDownblouse15_v3.2: f318a1602ae5\", Version: v1.6.0',
      'Steps: 20, Sampler: Euler a, CFG scale: 5, Seed: 424764998, Size: 512x904, Model hash: 240a6e795f, Model: aniverse_thxEd14, VAE hash: e9ed949371, VAE: anythingKlF8Anime2VaeFtMse840000_klF8Anime2.safetensors, Clip skip: 2, ADetailer model: face_yolov8n.pt, ADetailer confidence: 0.3, ADetailer dilate/erode: 4, ADetailer mask blur: 4, ADetailer denoising strength: 0.4, ADetailer inpaint only masked: True, ADetailer inpaint padding: 32, ADetailer version: 23.9.3, Lora hashes: \"skin_tone_slider_v1: e6e222474f54, muscle_slider_v1: d526d08bba31, add_detail: 7c6bad76eb54\", TI hashes: \"FastNegativeV2: a7465e7cc2a2, badhandv4: 5e40d722fc3d, SkinPerfection_NegV15: 56e8abe4d74d\", Noise multiplier: 0.494, Version: v1.6.0, Hashes: {\"vae\":\"e9ed949371\",\"embed:FastNegativeV2\":\"a7465e7cc2\",\"embed:SkinPerfection_NegV15\":\"56e8abe4d7\",\"embed:badhandv4\":\"5e40d722fc\",\"lora:skin_tone_slider_v1\":\"9ae92e3410\",\"lora:muscle_slider_v1\":\"c72272c75f\",\"lora:add_detail\":\"47aaaf0d29\",\"model\":\"240a6e795f\"}',
      'Steps: 30, Sampler: DPM++ 2M Karras, CFG scale: 7, Seed: 1220318683, Size: 512x768, Clip skip: 2, Civitai resources: [{\"type\":\"checkpoint\",\"modelVersionId\":161244},{\"type\":\"lora\",\"weight\":0.3,\"modelVersionId\":165572},{\"type\":\"lora\",\"weight\":0.4,\"modelVersionId\":87153},{\"type\":\"lora\",\"weight\":0.55,\"modelVersionId\":93432}]',
      'Steps: 20, Sampler: Euler a, CFG scale: 7, Seed: 5, Size: 768x1356, Model hash: 240a6e795f, Model: aniverse_thxEd14, VAE hash: e9ed949371, VAE: anythingKlF8Anime2VaeFtMse840000_klF8Anime2.safetensors, Denoising strength: 0.15, Clip skip: 2, ADetailer model: face_yolov8n.pt, ADetailer confidence: 0.3, ADetailer dilate/erode: 4, ADetailer mask blur: 4, ADetailer denoising strength: 0.4, ADetailer inpaint only masked: True, ADetailer inpaint padding: 32, ADetailer version: 23.9.3, Lora hashes: \"epiCRealismHelper: c5e24d9bc4b5, skin_tone_slider_v1: e6e222474f54, people_count_slider_v1: 4ef0b7737563\", TI hashes: \"jg-jc0n: 21bfa46a8167, FastNegativeV2: a7465e7cc2a2, badhandv4: 5e40d722fc3d\", Noise multiplier: 0.494, Version: v1.6.0',
      'Steps: 20, Sampler: DPM++ 2M Karras, Guidance Scale: 3.6, Seed: 4292234346, Size: 640x960, Model: photon_v1_f16.ckpt, Strength: 0.0, Seed Mode: Torch CPU Compatible, Upscaler: realesrgan_x2plus_f16.ckpt, Hires Fix: true, First Stage Size: 512x768, Second Stage Strength: 0.7',
    ]

    tests.forEach((paramStr, index) => {
      it(`should parse and re-serialize test case ${index}`, function () {
        this.timeout(0)
        const parsed = MDParams.parse(paramStr)
        const serialized = parsed.toString()
        assert.equal(serialized, paramStr)
      })
    })
  })
})
